# Excel VBA 坑

> 生活总是充满了冷漠与心寒，无奈，无奈 at 2014.12.17 00:33  

### 立即窗口打印输出：Debug.Print xxx

### Left函数

截取字符串左边多少位长度的字符串  

用法：  

``` vba
	Left("1234abcd", 4)

	输出: 1234
```

###  Application.CountA

利用函数 COUNTA 可以计算单元格区域或数组中包含数据的单元格个数  

用法： 

``` vba
Application.CountA(Range("C1:C28"))  

Application.CountA([b:b]])  计算b列
```

### Range

获取单元格范围

``` vba
Dim rg As Range  

Set rg = Range("b" & 2)  获取单元格B2

```

### 字典

创建字典对象Object

``` vba
Set d = CreateObject("scripting.dictionary")  
```

字典对象的遍历

``` vba
Set d = CreateObject("scripting.dictionary")  

...  


Dim key
For Each key in d
	Debug.Print key,d(key)
Next
```

### InStr

用于判断字符串是否包含另一个字符串，返回True或False

用法：  

``` vba
InStr(stringA,stringB)  判断stringA字符串是否包含stringB字符串
```

### 数据类型变量的定义

`%`表示数值，`$`表示字符...

``` vba
Dim a%  

Dim b$  

Dim c As Range  

Dim d  

Dim e() As String 定义字符串类型的数组e，e(0),e(1)
```

#### 数据类型

整型:   Integer， 简写%;  
单精度: Single,   简写!;  
双精度: Double,   简写#;  
长整型: Long，    简写&;  
字符型: String,   简写$;   
货币型: Currency, 简写@;  

``` vba
Sub 数据类型声明()
Dim a As Integer, b As Single, c As String
Dim d%, e!, f$ 
End Sub
```

### 工作簿 Workbook

``` vba
WorkBooks(1)  

WorkBooks("xxxx.xls")  

ThisWorkbook  当前工作簿  

ActiveWorkbook 被激活的工作簿  

ThisWorkbook.Name  工作簿的名称   

ThisWorkbook.Path  当前工作簿的路径  

ThisWorkbook.FullName  完整名称(路径+文件名)   

```

#### 常见操作

``` vba
' 新建工作簿

Sub 新建工作簿()
Dim wkb As Workbook '声明工作簿变量
Set wkb = Workbooks.Add '新建工作簿
wkb.SaveAs "c:\123.xls" '保存工作簿
End Sub

' 打开工作簿

Sub 打开工作簿()
Dim wkb As Workbook
Set wkb = Workbooks.Open("c:\123.xls")
End Sub

' 关闭工作簿

Sub 关闭()
Workbooks("123.xls").Close True
End Sub


' 文件复制和删除

Sub 文件复制和删除()
FileCopy "c:\123.xls", "c:\321.xls" ' 对所有文件类型起作用
Kill "c:\321.xls"
End Sub

```

